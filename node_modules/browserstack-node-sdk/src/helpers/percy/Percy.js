function a71_0x3ddb(){const _0x2f2077=['winstonLogger','SVnwu','pipe','path','percy/healthcheck',':start','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','PERCY_SERVER_ADDRESS','GET','fpOdy','env','3169890nAHHyu','263382nPrAtg','393609JGMEqV','../logger','error','exports','join','createWriteStream','stderr','BROWSERSTACK_TESTHUB_UUID','exec','lZrTm','flags','writeFile','AgeSe','isProcessRunning','projectName','percy.log','RprHy','debug','133aQpxVw','percyOptions','app:exec','jhSNR','ckXVr','Percy\x20fetch\x20token\x20success','ddpIv','XsyAN','data','3551346wPqIcN','Error\x20creating\x20percy\x20config:\x20','1178340qjabqH','szQhu','1247630jXAQhd','WBQLT','stringify','assign','BpigR','../helper','nodeRequest','gRrKy','exec:stop','createPercyConfig','api/app_percy/get_project_token?name=','healthcheck','99RGEzHv','../../helpers/testhub/constants','BLDUV','app','83320TPuboR','stop','OuWrT','&type=','8FBsYsc','start','version','fetchPercyToken','tmpdir','http://localhost:5338','./PercyBinary','token','ENV_VAR','GDWPC','close','automate','XehTE','ceKdV'];a71_0x3ddb=function(){return _0x2f2077;};return a71_0x3ddb();}const a71_0x2b3e45=a71_0x1b5b;(function(_0x511797,_0x1faa53){const _0x4d540e=a71_0x1b5b,_0x39cc92=_0x511797();while(!![]){try{const _0x226c81=-parseInt(_0x4d540e(0xc2))/0x1+parseInt(_0x4d540e(0xdf))/0x2+parseInt(_0x4d540e(0xc1))/0x3*(-parseInt(_0x4d540e(0xa7))/0x4)+-parseInt(_0x4d540e(0xc0))/0x5+-parseInt(_0x4d540e(0xdd))/0x6+-parseInt(_0x4d540e(0xd4))/0x7*(-parseInt(_0x4d540e(0xa3))/0x8)+parseInt(_0x4d540e(0x9f))/0x9*(parseInt(_0x4d540e(0xe1))/0xa);if(_0x226c81===_0x1faa53)break;else _0x39cc92['push'](_0x39cc92['shift']());}catch(_0x154c2c){_0x39cc92['push'](_0x39cc92['shift']());}}}(a71_0x3ddb,0x58f5e));function a71_0x1b5b(_0x307105,_0x383d9d){const _0x3ddb7a=a71_0x3ddb();return a71_0x1b5b=function(_0x1b5b77,_0x151965){_0x1b5b77=_0x1b5b77-0x97;let _0x32544f=_0x3ddb7a[_0x1b5b77];return _0x32544f;},a71_0x1b5b(_0x307105,_0x383d9d);}const fs=require('fs'),path=require(a71_0x2b3e45(0xb8)),os=require('os'),{spawn}=require('child_process'),helper=require(a71_0x2b3e45(0x98)),logger=require(a71_0x2b3e45(0xc3))[a71_0x2b3e45(0xb5)],{logDir}=require('../logger'),testHubConstants=require(a71_0x2b3e45(0xa0)),PercyBinary=require(a71_0x2b3e45(0xad));class Percy{#logfile=path['join'](logDir,a71_0x2b3e45(0xd1));#address=process[a71_0x2b3e45(0xbf)][a71_0x2b3e45(0xbc)]||a71_0x2b3e45(0xac);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a71_0x2b3e45(0xcf)]=![];constructor(_0x5066d7){const _0x5f48e0=a71_0x2b3e45;this.#config=_0x5066d7,!!_0x5066d7[_0x5f48e0(0xa2)]&&(this.#isApp=!![]);}async #getBinaryPath(){if(!this.#binaryPath){const _0x267fb0=new PercyBinary();this.#binaryPath=await _0x267fb0['getBinaryPath'](this.#config);}return this.#binaryPath;}async #sleep(_0x1e94f6){return new Promise(_0x2ea9c9=>setTimeout(_0x2ea9c9,_0x1e94f6));}async[a71_0x2b3e45(0x9e)](){const _0xb6f241=a71_0x2b3e45,_0x211463={};_0x211463[_0xb6f241(0xdb)]=_0xb6f241(0xbd),_0x211463[_0xb6f241(0xb3)]=_0xb6f241(0xb9);const _0x5e2a67=_0x211463;try{const _0x4f9480=await helper['nodeRequest'](_0x5e2a67[_0xb6f241(0xdb)],_0x5e2a67[_0xb6f241(0xb3)],null,null,this.#address);if(_0x4f9480)return!![];}catch(_0x4c9b40){return![];}}async[a71_0x2b3e45(0xa8)](){const _0x1719fa=a71_0x2b3e45,_0x449062={'SVnwu':_0x1719fa(0xd6),'ddpIv':_0x1719fa(0xca),'lZrTm':function(_0x365741,_0x49d95f,_0x44cdef,_0x906a48){return _0x365741(_0x49d95f,_0x44cdef,_0x906a48);},'fpOdy':_0x1719fa(0xb1),'WBQLT':'Percy\x20healthcheck\x20successful'},_0x58f853=await this.#getBinaryPath(),_0x3fe4eb={};_0x3fe4eb[_0x1719fa(0xcc)]='a';const _0x2b0406=fs[_0x1719fa(0xc7)](this.#logfile,_0x3fe4eb),_0x4ba425=await this['fetchPercyToken'](),_0x1fe807=await this[_0x1719fa(0x9c)]();if(!_0x4ba425)return![];const _0x9f89e2=[(this.#isApp?_0x449062[_0x1719fa(0xb6)]:_0x449062[_0x1719fa(0xda)])+_0x1719fa(0xba)];_0x1fe807&&_0x9f89e2['push']('-c',_0x1fe807);this.#proc=_0x449062[_0x1719fa(0xcb)](spawn,_0x58f853,_0x9f89e2,{'env':Object[_0x1719fa(0xe4)](process[_0x1719fa(0xbf)],{'PERCY_TOKEN':_0x4ba425,'TH_BUILD_UUID':process['env'][testHubConstants[_0x1719fa(0xaf)][_0x1719fa(0xc9)]]})}),this.#proc['stdout'][_0x1719fa(0xb7)](_0x2b0406),this.#proc[_0x1719fa(0xc8)][_0x1719fa(0xb7)](_0x2b0406),this[_0x1719fa(0xcf)]=!![];var _0x3bdc72=this;this.#proc['on'](_0x449062[_0x1719fa(0xbe)],function(_0x1d09b4){const _0x2fbf96=_0x1719fa;_0x3bdc72[_0x2fbf96(0xcf)]=![];});do{const _0x3d5807=await this[_0x1719fa(0x9e)]();if(_0x3d5807)return logger[_0x1719fa(0xd3)](_0x449062[_0x1719fa(0xe2)]),!![];await this.#sleep(0x3e8);}while(this['isProcessRunning']);return![];}async[a71_0x2b3e45(0xa4)](){const _0x27a8cb=a71_0x2b3e45,_0x46d76f={'ckXVr':function(_0x4aa562,_0x1602f3){return _0x4aa562(_0x1602f3);},'szQhu':function(_0xe55861,_0x35e229,_0x5bb08d){return _0xe55861(_0x35e229,_0x5bb08d);},'BpigR':_0x27a8cb(0x9b),'GRqKH':_0x27a8cb(0xb1)},_0x3611e3=await this.#getBinaryPath();return new Promise((_0x56eb74,_0xc1b2f1)=>{const _0x1173f5=_0x27a8cb,_0x2d2489={'exViU':function(_0x2cb039,_0x98806c){const _0x2f48c5=a71_0x1b5b;return _0x46d76f[_0x2f48c5(0xd8)](_0x2cb039,_0x98806c);}},_0x4e1572=_0x46d76f[_0x1173f5(0xe0)](spawn,_0x3611e3,[_0x46d76f[_0x1173f5(0x97)]]);_0x4e1572['on'](_0x46d76f['GRqKH'],_0x1da345=>{const _0x4bf63b=_0x1173f5;this[_0x4bf63b(0xcf)]=![],_0x2d2489['exViU'](_0x56eb74,_0x1da345);});});}['isRunning'](){const _0x1f8be3=a71_0x2b3e45;return this[_0x1f8be3(0xcf)];}async[a71_0x2b3e45(0xaa)](){const _0xd54ae7=a71_0x2b3e45,_0xafff7a={};_0xafff7a[_0xd54ae7(0xa5)]='app',_0xafff7a['jhSNR']=_0xd54ae7(0xb2),_0xafff7a['RprHy']=_0xd54ae7(0xbd),_0xafff7a['oBOaV']=_0xd54ae7(0xd9);const _0x2366f5=_0xafff7a,_0x11e22e=this.#config[_0xd54ae7(0xd0)];try{const _0x2e213d=this.#isApp?_0x2366f5[_0xd54ae7(0xa5)]:_0x2366f5[_0xd54ae7(0xd7)],_0x3af07c=await helper[_0xd54ae7(0x99)](_0x2366f5[_0xd54ae7(0xd2)],_0xd54ae7(0x9d)+_0x11e22e+_0xd54ae7(0xa6)+_0x2e213d,{},this.#config),_0x335182=_0x3af07c[_0xd54ae7(0xdc)];return logger['debug'](_0x2366f5['oBOaV']),_0x335182[_0xd54ae7(0xae)];}catch(_0x3bae00){return logger[_0xd54ae7(0xc4)](_0xd54ae7(0xbb)+_0x3bae00),null;}}async[a71_0x2b3e45(0x9c)](){const _0x3b0ab4=a71_0x2b3e45,_0x50d846={'AgeSe':function(_0x4f82b0,_0x1ac8b7){return _0x4f82b0(_0x1ac8b7);},'GDWPC':function(_0x30ac56,_0x434330){return _0x30ac56+_0x434330;},'ajdrV':'Percy\x20config\x20created\x20at\x20','EEIXJ':'percy.json'};if(!this.#config[_0x3b0ab4(0xd5)])return null;const _0xa9acc8=path[_0x3b0ab4(0xc6)](os[_0x3b0ab4(0xab)](),_0x50d846['EEIXJ']),_0x51f370=this.#config['percyOptions'];return!_0x51f370[_0x3b0ab4(0xa9)]&&(_0x51f370['version']='2'),new Promise((_0x4d714a,_0x49e805)=>{const _0x13ab33=_0x3b0ab4,_0x348a58={'gRrKy':function(_0x105ea9,_0x5163f4){const _0x5bc5d6=a71_0x1b5b;return _0x50d846[_0x5bc5d6(0xce)](_0x105ea9,_0x5163f4);},'ceKdV':function(_0x3cba36,_0x2c689f){const _0x247300=a71_0x1b5b;return _0x50d846[_0x247300(0xb0)](_0x3cba36,_0x2c689f);},'BLDUV':_0x50d846['ajdrV']};fs[_0x13ab33(0xcd)](_0xa9acc8,JSON[_0x13ab33(0xe3)](_0x51f370),_0x1cead3=>{const _0x195fc7=_0x13ab33;_0x1cead3&&(logger[_0x195fc7(0xc4)](_0x195fc7(0xde)+_0x1cead3),_0x348a58[_0x195fc7(0x9a)](_0x4d714a,null)),logger[_0x195fc7(0xd3)](_0x348a58[_0x195fc7(0xb4)](_0x348a58[_0x195fc7(0xa1)],_0xa9acc8)),_0x348a58[_0x195fc7(0x9a)](_0x4d714a,_0xa9acc8);});});}}module[a71_0x2b3e45(0xc5)]=Percy;
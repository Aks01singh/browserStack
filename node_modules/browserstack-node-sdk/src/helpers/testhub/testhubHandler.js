const a87_0xa15307=a87_0x45f2;function a87_0x3159(){const _0x19a58f=['config','12UTPHDc','../helper','debug','zltYx','stop','BROWSERSTACK_TEST_OBSERVABILITY','env','root_dir_path','../test-observability/sessionHandler.js','isUndefined','BS_TESTOPS_BUILD_COMPLETED','stringify','../test-observability/requestQueueHandler.js','\x20framework','qJdOT','lEFJI','2048849AMecHe','Hjuty','job_id','BROWSERSTACK_RERUN','password','nWciK','UvHhA','916iALPah','getGitMetaData','23547lftxgP','uploadPending','push','231AlhvBH','HEHoT','setupPercy','868959KGpjXS','null','true','ACCESSIBILITY','extractDataFromResponse','Exception\x20while\x20creating\x20test\x20run\x20for\x20BrowserStack\x20Accessibility\x20Automation:\x20Missing\x20authentication\x20token','settings','rqQJf','checkAndSetupPercy','ZGSGY','BROWSERSTACK_CENTRAL_SCANNER_JWT','JbtTT','DXptM','TESTHUB_BUILD_API','YJbZv','odkKV','6540YjKVZk','906xecrDp','buildIdentifier','data','KJfut','getConfig','Token/buildID\x20is\x20undefined,\x20build\x20creation\x20might\x20have\x20failed','BROWSERSTACK_PRODUCT_MAP','getAccessibilityOptions','./utils.js','status','getProductMap','setTestObservabilityVariables','XnUdK','cwd','MYdLL','getAccessKey','generateBuildUpstreamData','EXCEPTION\x20IN\x20BUILD\x20START\x20EVENT\x20:\x20Missing\x20authentication\x20token','BROWSERSTACK_ACCESSIBILITY','XhnYY','BROWSERSTACK_CENTRAL_USER','includes','1940siGFIK','projectName','jclLv','statusText','toISOString','PERCY_SUPPORTED_FRAMEWORKS','../logger','FQDis','238ZbfDLd','xyxiJ','buildName','18fuPVoy','allowScreenshot','buildStopSent','eWUMv','setTestHubCommonMetaInfo','error','isBrowserstackInfra','BROWSERSTACK_CENTRAL_SCANNER_JOBID','224tTKSCZ','../test-observability/utils','BukfE','auth','response','username','EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20','16904Qdmxdu','CyThJ','basename','false','./constants.js','buildDescription','PUT','BROWSERSTACK_TESTHUB_UUID','OBSERVABILITY','token','message','stopBuildUpstream\x20event\x20successful!','/stop','getUserName','buildHashedId','jwt','BROWSERSTACK_TESTHUB_JWT','QjWMW','percy','533170NFTnkE','ENV_VAR','assign','getCiInfo'];a87_0x3159=function(){return _0x19a58f;};return a87_0x3159();}(function(_0x39f384,_0x2b9938){const _0x1d2fd5=a87_0x45f2,_0x4eb414=_0x39f384();while(!![]){try{const _0x152ce8=parseInt(_0x1d2fd5(0x1cf))/0x1*(parseInt(_0x1d2fd5(0x22e))/0x2)+-parseInt(_0x1d2fd5(0x230))/0x3*(-parseInt(_0x1d2fd5(0x1f8))/0x4)+parseInt(_0x1d2fd5(0x1e5))/0x5*(parseInt(_0x1d2fd5(0x1ce))/0x6)+parseInt(_0x1d2fd5(0x233))/0x7*(parseInt(_0x1d2fd5(0x1ff))/0x8)+parseInt(_0x1d2fd5(0x1f0))/0x9*(-parseInt(_0x1d2fd5(0x212))/0xa)+parseInt(_0x1d2fd5(0x227))/0xb*(parseInt(_0x1d2fd5(0x217))/0xc)+-parseInt(_0x1d2fd5(0x236))/0xd*(parseInt(_0x1d2fd5(0x1ed))/0xe);if(_0x152ce8===_0x2b9938)break;else _0x4eb414['push'](_0x4eb414['shift']());}catch(_0x5d0fa0){_0x4eb414['push'](_0x4eb414['shift']());}}}(a87_0x3159,0x46e83));const bsSetupHelper=require(a87_0xa15307(0x218)),path=require('path'),{getCustomTags,isTestObservabilitySession,getDefaultHeaders,nodeRequest}=require(a87_0xa15307(0x1f9)),testhubUtils=require(a87_0xa15307(0x1d7)),testHubConstants=require(a87_0xa15307(0x203)),constants=require('../../bin/utils/constants.js'),RequestQueueHandler=require(a87_0xa15307(0x223)),logger=require(a87_0xa15307(0x1eb))['winstonLogger'],SessionHandler=require(a87_0xa15307(0x21f));function a87_0x45f2(_0x5c6375,_0x341895){const _0x3159fd=a87_0x3159();return a87_0x45f2=function(_0x45f25c,_0x32e82f){_0x45f25c=_0x45f25c-0x1c3;let _0x1d117f=_0x3159fd[_0x45f25c];return _0x1d117f;},a87_0x45f2(_0x5c6375,_0x341895);}class TestHubHandler{static ['buildStopSent']=![];static async['launchBuild'](_0x367517,_0x3b81df){const _0x24b31f=a87_0xa15307,_0x2c4a6a={'eWUMv':function(_0x5ae769,_0x4b6b32){return _0x5ae769||_0x4b6b32;},'zltYx':function(_0x34edf0,_0x40d8f8){return _0x34edf0===_0x40d8f8;},'rqQJf':function(_0x209c21){return _0x209c21();},'odkKV':_0x24b31f(0x1e0),'JbtTT':_0x24b31f(0x202),'UvHhA':_0x24b31f(0x1c3),'lQukf':function(_0x30e3a5,_0x49d191,_0x393c1b,_0xb0d433,_0x1b238b){return _0x30e3a5(_0x49d191,_0x393c1b,_0xb0d433,_0x1b238b);},'ZGSGY':'POST','MYdLL':function(_0x2f6aab,_0x44c73b){return _0x2f6aab===_0x44c73b;}},_0x3e20a8={};_0x3e20a8[_0x24b31f(0x21e)]='';const _0x4ceab4=Object[_0x24b31f(0x214)]({},_0x3b81df[_0x24b31f(0x216)],_0x3e20a8),_0x20afbc=bsSetupHelper[_0x24b31f(0x20c)](_0x4ceab4),_0x2a9aea=bsSetupHelper[_0x24b31f(0x1de)](_0x4ceab4),_0x3e7914=_0x2c4a6a[_0x24b31f(0x1f3)](_0x20afbc,'')+':'+_0x2c4a6a[_0x24b31f(0x1f3)](_0x2a9aea,''),_0x30f9bf=testhubUtils['getProductMap'](_0x4ceab4);process['env'][_0x24b31f(0x1d5)]=JSON[_0x24b31f(0x222)](_0x30f9bf);if(_0x2c4a6a[_0x24b31f(0x21a)](_0x3e7914,':'))return _0x2c4a6a[_0x24b31f(0x1c5)](isTestObservabilitySession)&&(logger['debug'](_0x2c4a6a[_0x24b31f(0x1cd)]),process[_0x24b31f(0x21d)][_0x24b31f(0x221)]=_0x2c4a6a[_0x24b31f(0x1c9)]),testhubUtils['isAccessibilityEnabled'](_0x4ceab4)&&logger['debug'](_0x2c4a6a[_0x24b31f(0x22d)]),[null,null];try{const _0x58b20a=await this[_0x24b31f(0x1df)](_0x4ceab4,_0x367517),_0x107890=this['getConfig'](_0x20afbc,_0x2a9aea),_0x6d16da=await _0x2c4a6a['lQukf'](nodeRequest,_0x2c4a6a[_0x24b31f(0x1c7)],testHubConstants[_0x24b31f(0x1cb)],_0x58b20a,_0x107890);await this[_0x24b31f(0x1c6)](_0x3b81df,_0x367517);const _0x2f72be=this[_0x24b31f(0x23a)](_0x4ceab4,_0x6d16da,_0x107890);return _0x2f72be;}catch(_0x5bc790){if(_0x2c4a6a[_0x24b31f(0x1dd)](_0x5bc790['success'],![])){testhubUtils['logBuildError'](_0x5bc790);return;}}}static async[a87_0xa15307(0x1c6)](_0x2dbd82,_0xe1a86b){const _0x27867b=a87_0xa15307;if(constants[_0x27867b(0x1ea)][_0x27867b(0x1e4)](_0xe1a86b)){await _0x2dbd82[_0x27867b(0x235)]();return;}_0x2dbd82[_0x27867b(0x216)][_0x27867b(0x211)]&&logger['debug']('Percy\x20is\x20not\x20supported\x20for\x20'+_0xe1a86b+_0x27867b(0x224));}static[a87_0xa15307(0x1d6)](_0x4fb941){const _0x4cfabc=a87_0xa15307,_0x1ad0e5={};_0x1ad0e5[_0x4cfabc(0x1c4)]=_0x4fb941['accessibilityOptions'];const _0x217976=_0x1ad0e5;return _0x217976;}static[a87_0xa15307(0x1d3)](_0x45ad82,_0x1335f9){const _0x4043ce=a87_0xa15307,_0x310063={'KJfut':function(_0x40a8e6,_0x4f7803){return _0x40a8e6(_0x4f7803);}},_0x5354fa={};return _0x5354fa[_0x4043ce(0x1fd)]=_0x45ad82,_0x5354fa[_0x4043ce(0x22b)]=_0x1335f9,{'auth':_0x5354fa,'headers':_0x310063[_0x4043ce(0x1d2)](getDefaultHeaders,![])};}static async[a87_0xa15307(0x1df)](_0x2b3157,_0x138b81){const _0x2afa4b=a87_0xa15307,_0x4296f7={'CyThJ':function(_0x2bd5b0,_0x59f70a){return _0x2bd5b0(_0x59f70a);}},_0x1e7215={'project_name':_0x2b3157[_0x2afa4b(0x1e6)]||'','name':_0x2b3157[_0x2afa4b(0x1ef)]||path[_0x2afa4b(0x201)](path['resolve'](process[_0x2afa4b(0x1dc)]())),'build_identifier':_0x2b3157[_0x2afa4b(0x1d0)],'description':_0x2b3157[_0x2afa4b(0x204)]||'','started_at':new Date()[_0x2afa4b(0x1e9)](),'tags':_0x4296f7[_0x2afa4b(0x200)](getCustomTags,_0x2b3157),'host_info':bsSetupHelper['getHostInfo'](),'ci_info':bsSetupHelper[_0x2afa4b(0x215)](),'build_run_identifier':process[_0x2afa4b(0x21d)]['BROWSERSTACK_BUILD_RUN_IDENTIFIER'],'failed_tests_rerun':process[_0x2afa4b(0x21d)][_0x2afa4b(0x22a)]||![],'version_control':await bsSetupHelper[_0x2afa4b(0x22f)](),'accessibility':this['getAccessibilityOptions'](_0x2b3157),'framework_details':testhubUtils['getFrameworkDetails'](_0x2b3157,_0x138b81),'product_map':testhubUtils[_0x2afa4b(0x1d9)](_0x2b3157),'browserstackAutomation':bsSetupHelper[_0x2afa4b(0x1f6)]()};if(process[_0x2afa4b(0x21d)][_0x2afa4b(0x1e3)]){const _0x471931={};_0x471931[_0x2afa4b(0x229)]=process[_0x2afa4b(0x21d)][_0x2afa4b(0x1f7)],_0x471931[_0x2afa4b(0x208)]=process['env'][_0x2afa4b(0x1c8)],_0x1e7215['central_scanner']=_0x471931;}return _0x1e7215;}static[a87_0xa15307(0x23a)](_0x20b883,_0x561500,_0x46e8ef){const _0x15e54b=a87_0xa15307,_0xa96d6d={'oHaaK':function(_0x3fd400){return _0x3fd400();},'xyxiJ':function(_0x4c1bb1,_0x2fab92){return _0x4c1bb1&&_0x2fab92;},'jclLv':_0x15e54b(0x238),'HEHoT':_0x15e54b(0x202),'nWciK':function(_0x9aecb1,_0x34036c){return _0x9aecb1&&_0x34036c;}},_0xf72a3a={};if(_0xa96d6d['oHaaK'](isTestObservabilitySession)){const [_0x5f3fd8,_0x5ccda9,_0x23fed2]=testhubUtils[_0x15e54b(0x1da)](_0x561500[_0x15e54b(0x1d1)],_0x46e8ef[_0x15e54b(0x1fb)]);if(_0xa96d6d[_0x15e54b(0x1ee)](_0x5f3fd8,_0x5ccda9)){const _0x1d3b17={};_0x1d3b17[_0x15e54b(0x20e)]=_0x5f3fd8,_0x1d3b17[_0x15e54b(0x20d)]=_0x5ccda9,_0x1d3b17[_0x15e54b(0x1f1)]=_0x23fed2,_0xf72a3a[testHubConstants[_0x15e54b(0x207)]]=_0x1d3b17,process[_0x15e54b(0x21d)][_0x15e54b(0x21c)]=_0xa96d6d[_0x15e54b(0x1e7)];}else _0xf72a3a[testHubConstants[_0x15e54b(0x207)]]={},process[_0x15e54b(0x21d)][_0x15e54b(0x21c)]=_0xa96d6d['HEHoT'];}else process[_0x15e54b(0x21d)][_0x15e54b(0x21c)]=_0xa96d6d[_0x15e54b(0x234)];if(testhubUtils['isAccessibilityEnabled'](_0x20b883)){const [_0x31458a,_0x569f12]=testhubUtils['setAccessibilityVariables'](_0x561500[_0x15e54b(0x1d1)]);if(_0xa96d6d[_0x15e54b(0x22c)](_0x31458a,_0x569f12)){const _0x1c6741={};_0x1c6741['authToken']=_0x31458a,_0x1c6741['buildHashedId']=_0x569f12,_0xf72a3a[testHubConstants[_0x15e54b(0x239)]]=_0x1c6741,process[_0x15e54b(0x21d)][_0x15e54b(0x1e1)]=_0xa96d6d[_0x15e54b(0x1e7)];}else _0xf72a3a[testHubConstants[_0x15e54b(0x239)]]={},process[_0x15e54b(0x21d)][_0x15e54b(0x1e1)]=_0xa96d6d[_0x15e54b(0x234)];}else process[_0x15e54b(0x21d)][_0x15e54b(0x1e1)]=_0xa96d6d['HEHoT'];return testhubUtils[_0x15e54b(0x1f4)](_0x561500[_0x15e54b(0x1d1)]),_0xf72a3a;}static async[a87_0xa15307(0x21b)](_0x1df8fe){const _0x527dd1=a87_0xa15307,_0x56fadb={'QjWMW':function(_0x4b6daa,_0x57fd98){return _0x4b6daa===_0x57fd98;},'XhnYY':_0x527dd1(0x202),'aKPca':function(_0x4c9984,_0x3431aa){return _0x4c9984===_0x3431aa;},'YJbZv':_0x527dd1(0x237),'FQDis':'EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20Missing\x20authentication\x20token','XnUdK':_0x527dd1(0x1f5),'qJdOT':_0x527dd1(0x1d4),'Hjuty':'finished_metadata','YzDeM':'user_killed','DXptM':function(_0x2e2cc0){return _0x2e2cc0();},'lEFJI':function(_0x2d66e8,_0x464bcc,_0x4dde68,_0x595cb4,_0x4448f0,_0x44a1ff){return _0x2d66e8(_0x464bcc,_0x4dde68,_0x595cb4,_0x4448f0,_0x44a1ff);},'CwJHC':_0x527dd1(0x205),'BukfE':_0x527dd1(0x20a),'EHXiO':'success'};if(_0x56fadb[_0x527dd1(0x210)](process['env'][_0x527dd1(0x221)],_0x56fadb[_0x527dd1(0x1e2)])||this[_0x527dd1(0x1f2)]||bsSetupHelper[_0x527dd1(0x220)](process[_0x527dd1(0x21d)][testHubConstants['ENV_VAR'][_0x527dd1(0x20f)]]))return;this[_0x527dd1(0x1f2)]=!![],await RequestQueueHandler['getInstance']()[_0x527dd1(0x231)](),await SessionHandler['waitForBuildStatus']();if(_0x56fadb['aKPca'](process[_0x527dd1(0x21d)][testHubConstants['ENV_VAR'][_0x527dd1(0x20f)]],_0x56fadb['YJbZv'])||_0x56fadb['aKPca'](process[_0x527dd1(0x21d)][testHubConstants['ENV_VAR'][_0x527dd1(0x206)]],_0x56fadb[_0x527dd1(0x1cc)])){logger[_0x527dd1(0x219)](_0x56fadb[_0x527dd1(0x1ec)]);const _0x3482fc={};return _0x3482fc['status']=_0x56fadb['XnUdK'],_0x3482fc[_0x527dd1(0x209)]=_0x56fadb[_0x527dd1(0x225)],_0x3482fc;}const _0x5ba52d={'finished_at':new Date()[_0x527dd1(0x1e9)](),'finished_metadata':[]};!!_0x1df8fe&&_0x5ba52d[_0x56fadb[_0x527dd1(0x228)]][_0x527dd1(0x232)]({'reason':_0x56fadb['YzDeM'],'signal':_0x1df8fe,'failure_data':''});const _0x4d3aa4={'headers':_0x56fadb[_0x527dd1(0x1ca)](getDefaultHeaders)};try{const _0x54d318=await _0x56fadb[_0x527dd1(0x226)](nodeRequest,_0x56fadb['CwJHC'],'api/v1/builds/'+process[_0x527dd1(0x21d)][testHubConstants[_0x527dd1(0x213)]['BROWSERSTACK_TESTHUB_UUID']]+_0x527dd1(0x20b),_0x5ba52d,_0x4d3aa4,![]);if(_0x54d318[_0x527dd1(0x1d1)]&&_0x54d318[_0x527dd1(0x1d1)][_0x527dd1(0x1f5)]){const _0x17cb3d={};_0x17cb3d[_0x527dd1(0x209)]=_0x54d318[_0x527dd1(0x1d1)][_0x527dd1(0x1f5)];throw _0x17cb3d;}else{logger[_0x527dd1(0x219)](_0x56fadb[_0x527dd1(0x1fa)]);const _0x2bc098={};return _0x2bc098[_0x527dd1(0x1d8)]=_0x56fadb['EHXiO'],_0x2bc098[_0x527dd1(0x209)]='',_0x2bc098;}}catch(_0x1cc8bc){_0x1cc8bc['response']?logger['debug'](_0x527dd1(0x1fe)+_0x1cc8bc[_0x527dd1(0x1fc)][_0x527dd1(0x1d8)]+'\x20'+_0x1cc8bc[_0x527dd1(0x1fc)][_0x527dd1(0x1e8)]+'\x20'+JSON[_0x527dd1(0x222)](_0x1cc8bc[_0x527dd1(0x1fc)][_0x527dd1(0x1d1)])):logger[_0x527dd1(0x219)]('EXCEPTION\x20IN\x20stopBuildUpstream\x20REQUEST\x20TO\x20TESTHUB\x20:\x20'+(_0x1cc8bc[_0x527dd1(0x209)]||_0x1cc8bc));const _0x1f0b12={};return _0x1f0b12[_0x527dd1(0x1d8)]=_0x56fadb[_0x527dd1(0x1db)],_0x1f0b12['message']=_0x1cc8bc['message']||_0x1cc8bc[_0x527dd1(0x1fc)]?_0x1cc8bc['response'][_0x527dd1(0x1d8)]+':'+_0x1cc8bc[_0x527dd1(0x1fc)][_0x527dd1(0x1e8)]:_0x1cc8bc,_0x1f0b12;}}}module['exports']=TestHubHandler;